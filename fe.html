<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard Element Zoom</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <style>
      .dashboard-container {
        display: grid;
        grid-template-rows: minmax(3em, 60fr) minmax(3em, 40fr);
        grid-auto-columns: minmax(0, 1fr);
        height: 100vh;
        gap: 1rem;
      }

      .dashboard-item {
        border: 1px solid #ccc;
        padding: 1rem;
        background-color: #f8f9fa;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
      }

      .zoom-button {
        position: absolute;
        top: 10px;
        right: 10px;
        z-index: 10;
      }

      /* Modal personalizado */
      .modal-dialog-fullscreen {
        max-width: 90%; /* Casi el ancho completo */
        max-height: 90%; /* Casi el alto completo */
        margin: auto;
      }

      .modal-body {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100%; /* Asegura que el gráfico ocupe toda el área */
      }

      #modalContent {
        width: 100%;
        height: 90vh; /* Ajusta el gráfico al tamaño del modal */
      }
    </style>
  </head>
  <body class="quarto-dashboard dashboard-fill fullcontent quarto-light bslib-has-full-screen">
    <header id="quarto-dashboard-header" class="p-3 bg-primary text-white">
      <h1>Interactive Dashboard</h1>
    </header>

    <div class="dashboard-container">
      <!-- Item 1 -->
      <div class="dashboard-item">
        <div id="chart1" style="width: 100%; height: 100%;">
          <p>Gráfico #1</p>
        </div>
        <button class="btn btn-primary btn-sm zoom-button" onclick="openZoomModal('chart1')">Zoom</button>
      </div>

      <!-- Item 2 -->
      <div class="dashboard-item">
        <div id="chart2" style="width: 100%; height: 100%;">
          <p>Gráfico #2</p>
        </div>
        <button class="btn btn-primary btn-sm zoom-button" onclick="openZoomModal('chart2')">Zoom</button>
      </div>
    </div>

    <!-- Modal -->
    <div
      class="modal fade"
      id="zoomModal"
      tabindex="-1"
      aria-labelledby="zoomModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-fullscreen">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="zoomModalLabel">Vista ampliada</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <!-- Contenedor del gráfico en el modal -->
            <div id="modalContent"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
     // Variable para almacenar la instancia del gráfico en el modal
let modalChart = null;

// Función para abrir el modal con contenido ampliado
function openZoomModal(chartId) {
  const sourceChart = echarts.getInstanceByDom(document.getElementById(chartId));
  const modalContent = document.getElementById('modalContent');

  // Limpiar cualquier gráfico existente en el modal
  if (modalChart) {
    modalChart.dispose(); // Destruir la instancia del gráfico anterior
    modalChart = null; // Resetear la variable
  }

  // Crear el gráfico en el contenedor del modal
  modalChart = echarts.init(modalContent);

  // Copiar la configuración del gráfico original al gráfico del modal
  modalChart.setOption(sourceChart.getOption());

  // Mostrar el modal usando Bootstrap
  const zoomModal = document.getElementById('zoomModal');
  const modalInstance = new bootstrap.Modal(zoomModal);

  zoomModal.addEventListener('shown.bs.modal', () => {
    setTimeout(() => {
      modalChart.resize(); // Redimensionar el gráfico cuando el modal esté completamente visible
    }, 100); // Espera 100ms para asegurar el renderizado correcto
  });

  modalInstance.show();
}

// Inicializar los gráficos al cargar la página
function initializeCharts() {
  const options = {
    title: { text: 'Ejemplo de gráfico' },
    xAxis: { data: ['A', 'B', 'C', 'D', 'E'] },
    yAxis: {},
    series: [{ type: 'bar', data: [5, 20, 36, 10, 10] }],
  };

  const chart1 = echarts.init(document.getElementById('chart1'));
  chart1.setOption(options);

  const chart2 = echarts.init(document.getElementById('chart2'));
  chart2.setOption(options);
}

document.addEventListener('DOMContentLoaded', initializeCharts);
    </script>
  </body>
</html>
